<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Chris Forster: Looking at a Dataset for Distant Reading: Some Anticlimaxes
</title>
    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" type="text/css" href="/css/pygments.css" />
    <link rel="stylesheet" type="text/css" href="/css/style.css" />
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="cforster.com Atom feed" />
  </head>
  <body>

    <article class="post">
      <div class="frontmatter">
	<h1 class="title"><p>Looking at a Dataset for Distant Reading: Some Anticlimaxes</p>
</h1>

	<time class="timestamp" datetime="2015-08-10" >Aug 10, 2015</time>
      </div>

      <div class="post-content">
	<p>I’ve been trying to think intelligently about the place of quantitative data in literary studies, especially in light of two excellent posts, one by <a href="http://andrewgoldstone.com/blog/2015/08/08/distant/">Andrew Goldstone</a>, the other by <a href="http://tressiemc.com/2015/08/06/nascent-thoughts-on-text-analysis-across-disciplines/">Tressie McMillan Cottom</a>, both responding to <a href="http://bostonreview.net/books-ideas/ben-merriman-moretti-jockers-digital-humanities">this review</a> by Ben Merriman.</p>
<p>But before I could even try to say something interesting in response, Ted Underwood <a href="http://tedunderwood.com/2015/08/07/a-dataset-for-distant-reading-literature-in-english-1700-1922/">announced</a> that he was making available “a dataset for distant-reading literature in English, 1700-1922” (here is <a href="https://sharc.hathitrust.org/genre">a link to the data</a>). This post is a look at that data, mostly using <a href="https://www.r-project.org/"><code>R</code></a>. I have, essentially, nothing thoughtful to offer in this post; instead, this is an exploration of this dataset (many, <em>many</em> thanks to Ted Underwood and HathiTrust for this fascinating bounty), studded with some anticlimaxes in the form of graphs that do little beyond give a sense of how one could begin to think about this dataset.</p>
<p>With the exception of a bash script (which may, though, be the most repurposable bit of code), everything here is done in <code>R</code>. I don’t like <code>R</code>, and I’m not very good with it,<span class="marginnote">I think <code>R</code>’s datatypes are what make it a challenge; lists in particular seem to materialize out of nowhere and are frustrating to use…</span> but it is great for making pretty graphs and getting an initial handle on a bunch of data. I try to comment on, and explain, the code below (often in comments)—though if you’ve never looked at <code>R</code>, this may seem really weird. I also may have made some horrible mistakes; if so, please let me know.</p>
<h2 id="the-new-hathitrust-data-set">The New HathiTrust Data Set</h2>
<p>Underwood calls this dataset “an easier place to start with English-language literature” within the HathiTrust dataset. I had poked around the HathiTrust data before, and it really is a very complicated undertaking. This dataset that Underwood has provided makes this <em>much much easier</em>.</p>
<p>The data can be downloaded <a href="https://sharc.hathitrust.org/genre">here</a>. In this post I’ll look at the fiction metadata, and take a peak at the fiction word counts for the years 1915–1919. Those files looks something like this:</p>
<ul>
<li><p><code>fiction_metadata.csv</code>: 17 megabytes, containing author, title, date, and place for each work of fiction. It also includes subjects, an id for HathiTrust (<code>htid</code>), and other fields.</p></li>
<li><p><code>fiction_yearly_summary.csv</code>: 35 megabytes, containing token frequencies. The first 20 lines look like this.</p></li>
</ul>
<pre><code>year,word,termfreq,correctionapplied
1701,&#39;,162,0
1701,a,813,0
1701,further,2,0
1701,native,1,0
1701,forgot,9,0
1701,mayor,1,0
1701,wonder,13,0
1701,incapable,3,0
1701,reflections,5,0
1701,absence,5,0
1701,far,16,0
1701,performance,2,0
1701,say,44,43
1701,notorious,1,0
1701,words,15,0
1701,leaves,2,0
1701,unlucky,2,0
1701,aware,1,0
1701,differ,1,0</code></pre>
<ul>
<li><p>
In a directory I uncompressed <code>fiction_1915-1919.tar.gz</code>. The result is 8656 files, each representing a single work, and totalling 827 megabytes. (827 megabytes of text is not “big data”—but it is enough to making toying with it on your laptop at times a little tricky.)
</p></li>
</ul>
<h2 id="examining-the-metadata-volumes-of-fiction-per-year">Examining the Metadata: Volumes of Fiction Per Year</h2>
<p>So, let’s begin, by loading our plotting library (<code>ggplot</code>) and the CSV file with the fiction metadata file <code>fiction_metadata.csv</code>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the metadata from the CSV vile</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>fiction.data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&#39;fiction_metadata.csv&#39;</span>,<span class="at">header=</span>T)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s look at how many items we have for each date.</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(fiction.data) <span class="sc">+</span> </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x=</span>fiction.data<span class="sc">$</span>date),<span class="at">binwidth=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&#39;Books per Year in Fiction Dataset&#39;</span>) <span class="sc">+</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&#39;Year&#39;</span>) <span class="sc">+</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&#39;Number of Books Per Year in Fiction Data&#39;</span>)</span></code></pre></div>
<p><a href="/images/htdata-plot1.png"><img src="/images/htdata-plot1.png" alt="Bar Plot of Works of Fiction Per Year in HathiTrust Dataset" /></a></p>
<p>This gives a sense of just how few books from before 1800 are in this dataset.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(fiction.data)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>   [<span class="dv">1</span>] <span class="dv">101948</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(<span class="fu">subset</span>(fiction.data,fiction.data<span class="sc">$</span>date <span class="sc">&lt;</span> <span class="dv">1800</span>))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>   [<span class="dv">1</span>] <span class="dv">1129</span></span></code></pre></div>
<p>That is, 101948 volumes total, 1129 of which were published prior to 1800, or about 1%. The number of volumes appearing in the dataset per year tends to increase constantly—with a few exceptions. That dip around 1861-1864 may be a result of particularly American factors influencing the dataset; and perhaps it is war again accounts for some of the dip at this period end—though that dip seems to begin prior to 1914.</p>
<h2 id="examining-the-metadata-change-in-length-of-volumes-over-time">Examining the Metadata: Change in Length of Volumes Over Time</h2>
<p>The length of each volume is contained in the <code>totalpages</code> field in the metadata file. Let’s plot the length of works of fiction over time (so, plot <code>date</code> by <code>totalpages</code>).</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(fiction.data,<span class="fu">aes</span>(<span class="at">x=</span>fiction.data<span class="sc">$</span>date,<span class="at">y=</span>fiction.data<span class="sc">$</span>totalpages)) <span class="sc">+</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">pch=</span><span class="st">&#39;.&#39;</span>,<span class="at">alpha=</span><span class="fl">0.1</span>,<span class="at">color=</span><span class="st">&#39;blue&#39;</span>) <span class="sc">+</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&#39;Length of Books by Year&#39;</span>) <span class="sc">+</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&#39;Year&#39;</span>) <span class="sc">+</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&#39;Length of Book, in Pages&#39;</span>)</span></code></pre></div>
<p><a href="/images/htdata-plot2.png"><img src="/images/htdata-plot2.png" alt="Not Especially Legible Plot of Length of Works of Fiction Over Time in HathiTrust Dataset" /></a></p>
<p>Interesting. It seems that, in the mid-eighteenth century near the dawn of the novel, works of fiction were around 300 pages long. Their length diversified over the course of the novel’s history, as novels grew both longer and shorter as the possibilities for fiction widened, perhaps as a function of increased readership stemming from both the decreasing cost of books and the increasing rate of literacy.</p>
<p>Well, <strong>not really</strong>. Matthew Lincoln has <a href="http://matthewlincoln.net/2015/03/21/confabulation-in-the-humanities.html">a very nice post</a> about the dangers of constructing a “just-so” story (often to insist that this graph tells us “nothing new). But there are at least two problems with the interpretation offered above—one broad and one more specific. Broadly, it is worth reiterating the danger of mistaking this data for an unproblematic representation of any particular historical phenomenon (say especially <em>readership of novels</em>). Underwood describes the dataset carefully as representing works held by”‘American university and public libraries, insofar as they were digitized in the year 2012 (when the project began).’" And, of course, lots of other things which would be relevant to an investigation of fiction—think of pulp paperbacks and similar forms—will not be in that sample, because they were often not collected by libraries. (Likeiwse, as Underwood notes, pre 1800 books are more likely to be held in Special Collections, and therefore not digitized).</p>
<p>The second point is specific to the graph above. That scatter plot is sparse in the early half of this period and very dense in the latter half. The translucency of each point (set by <code>alpha=0.2</code>) captures some of this, but nevertheless the graph as a whole overemphases the increased <em>spread</em> of data, when really what is happening is an increase in the amount of data. If we plot things differently, I think this becomes evident. Let’s breakdown our data by decade, and then do a <a href="https://en.wikipedia.org/wiki/Box_plot">box plot</a> per decade of fiction length:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This helper function will convert a year into a &quot;decade&quot;</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># through some simple division and then return the decade</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># as a &quot;factor&quot; (an R data-type).</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>as.Decade <span class="ot">&lt;-</span> <span class="cf">function</span>(year) {</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  decade <span class="ot">&lt;-</span> (<span class="fu">as.numeric</span>(year)<span class="sc">%/%</span><span class="dv">10</span>)<span class="sc">*</span><span class="dv">10</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">as.factor</span>(decade))</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a &quot;decade&quot; column by applying our as.Decade function </span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co"># to the data. (The unlist function... is because lapply returns</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co"># a list, and I&#39;m not very good at R, so that&#39;s how I got it to work.</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>fiction.data<span class="sc">$</span>decade <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(fiction.data<span class="sc">$</span>date, as.Decade))</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Box plot of our length data, grouped by decade</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(fiction.data, </span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>fiction.data<span class="sc">$</span>decade,<span class="at">y=</span>fiction.data<span class="sc">$</span>totalpages)) <span class="sc">+</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&#39;Length of Books, Grouped by Decades&#39;</span>) <span class="sc">+</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&#39;Decade&#39;</span>) <span class="sc">+</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&#39;Length of Books, in Pages&#39;</span>)</span></code></pre></div>
<p><a href="/images/htdata-plot3.png"><img src="/images/htdata-plot3.png" alt="Less Misleading Plot of Length Across Time in HathiTrust Fiction Dataset" /></a></p>
<p>This plot confirms that, indeed, we see a greater range in the lengths of works of fiction (so my inference from the previous graph is not completely wrong). But a box plot clarifies what is, to me, a surprising constancy in the length of the works collected in this dataset. The apparent increase in variability in length is real—but it is not the most, or the only, salient feature of this data; this fact is better captured in the second graph (the box plot).</p>
<h2 id="summary-frequently-occurring-terms">Summary: Frequently Occurring Terms</h2>
<p>The file <code>fiction_yearly_summary.csv</code> contains the per-year frequencies of the top 10,000 most frequently occuring tokens in the fiction dataset. We can chart the fluctuations of a term’s use, for instance, across the period.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load our data</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>yearly.summary <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&#39;fiction_yearly_summary.csv&#39;</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract some meaninful bit, say, occurences of `love`</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>love <span class="ot">&lt;-</span> <span class="fu">subset</span>(yearly.summary, yearly.summary<span class="sc">$</span>word<span class="sc">==</span><span class="st">&#39;love&#39;</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot it</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(love,<span class="fu">aes</span>(<span class="at">x=</span>love<span class="sc">$</span>year,<span class="at">y=</span>love<span class="sc">$</span>termfreq)) <span class="sc">+</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Occurences of token &#39;love&#39;&quot;</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&#39;Year&#39;</span>) <span class="sc">+</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&#39;&quot;Love&quot; in the Dataset&#39;</span>)</span></code></pre></div>
<p><a href="/images/htdata-plot4.png"><img src="/images/htdata-plot4.png" alt="Unnormalized Occurences of the Term ‘Love’ in Dataset" /></a></p>
<p>Yet, of course, looking at that sharp rise, we quickly realize—yet again—the importance of normalization. We are not witnessing the explosion of love at the dawn of the twentieth century (and its nearly as rapid declension). We could noralize by adding all the words together—but we only have counts for the top 10,000 wods. Thankfully, the dataset offers “three special tokens for each year: #ALLTOKENS counts all the tokens in each year, including numbers and punctuation; #ALPHABETIC only counts alphabetic tokens; and #DICTIONARYWORD counts all the tokens that were found in an English dictionary.”</p>
<p>So, let’s normalize by using DICTIONARYWORD.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s extract the DICTIONARYWORD tokens into a data frame</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>yearly.total <span class="ot">&lt;-</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">subset</span>(yearly.summary,yearly.summary<span class="sc">$</span>word<span class="sc">==</span><span class="st">&#39;#DICTIONARYWORD&#39;</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s simplify this dataframe to just what we&#39;re interested in.</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>yearly.total <span class="ot">&lt;-</span> yearly.total[<span class="fu">c</span>(<span class="st">&#39;year&#39;</span>,<span class="st">&#39;termfreq&#39;</span>)]</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co"># And rename the termfreq column to &quot;total&quot;</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(yearly.total) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;year&#39;</span>,<span class="st">&#39;total&#39;</span>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Now we can use merge to combine this data, giving each row </span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co"># a column that contains the total number of (dictionary words)</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co"># for that year. </span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>love.normalized <span class="ot">&lt;-</span> <span class="fu">merge</span>(love, yearly.total, <span class="at">by=</span><span class="fu">c</span>(<span class="st">&#39;year&#39;</span>))</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co"># This method profligately repreats data; but it makes things </span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co"># easier. The result looks like this:</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(love.normalized)</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span>   year word termfreq correctionapplied  total</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="dv">1</span> <span class="dv">1701</span> love      <span class="dv">222</span>                 <span class="dv">0</span>  <span class="dv">37234</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="dv">2</span> <span class="dv">1702</span> love        <span class="dv">1</span>                 <span class="dv">0</span>   <span class="dv">7036</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="dv">3</span> <span class="dv">1703</span> love      <span class="dv">524</span>                 <span class="dv">0</span> <span class="dv">416126</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="dv">4</span> <span class="dv">1706</span> love       <span class="dv">12</span>                 <span class="dv">0</span>  <span class="dv">36501</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="dv">5</span> <span class="dv">1708</span> love      <span class="dv">578</span>                 <span class="dv">0</span> <span class="dv">482779</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="dv">6</span> <span class="dv">1709</span> love      <span class="dv">361</span>                 <span class="dv">0</span> <span class="dv">133847</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, graph the data</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(love,</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>love.normalized<span class="sc">$</span>year,</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>           <span class="at">y=</span>(love.normalized<span class="sc">$</span>termfreq<span class="sc">/</span>love.normalized<span class="sc">$</span>total)))<span class="sc">+</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&#39;Year&#39;</span>) <span class="sc">+</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&#39;Normalized Frequency of &quot;love&quot;&#39;</span>) <span class="sc">+</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&#39;The Fate of Love&#39;</span>)</span></code></pre></div>
<p><a href="/images/htdata-plot5.png"><img src="/images/htdata-plot5.png" alt="Normalized Plot of ‘Love’ in the Dataset" /></a></p>
<p>Well, that look’s about right. Just for fun, let’s try a different term, one that is something less of an ever-fixed mark, but which perhaps alters its relative frequency when it historical alteration finds.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We subset the term we&#39;re interested in.</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>america <span class="ot">&lt;-</span> <span class="fu">subset</span>(yearly.summary, yearly.summary<span class="sc">$</span>word<span class="sc">==</span><span class="st">&#39;america&#39;</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># And normalize using our already-constructed yearly.total </span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># data frame.</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>america.normalized <span class="ot">&lt;-</span> <span class="fu">merge</span>(america, yearly.total, <span class="at">by=</span><span class="fu">c</span>(<span class="st">&#39;year&#39;</span>))</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot as before, though this time we&#39;ll use geom_smooth() </span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># as well to add a quick &quot;smooth&quot; fit line to get a sense of </span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co"># the trend. Minor digression: things like geom_smooth() are one </span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co"># of the things that make R great (if very dangerous) for an </span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co"># utter amateur.</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(america.normalized,</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x=</span>america.normalized<span class="sc">$</span>year,</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">y=</span>(america.normalized<span class="sc">$</span>termfreq<span class="sc">/</span>america.normalized<span class="sc">$</span>total)))<span class="sc">+</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&#39;Year&#39;</span>) <span class="sc">+</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&#39;Normalized Frequency of &quot;america&quot;&#39;</span>) <span class="sc">+</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Occurences of &#39;america&#39; in the Dataset&quot;</span>)</span></code></pre></div>
<p><a href="/images/htdata-plot6.png"><img src="/images/htdata-plot6.png" alt="Occurences of ‘america’ in the Dataset" /></a></p>
<p>Not sure there’s much surprising here, but okay, seems reasonablish.</p>
<h2 id="extracting-counts-from-individual-volume-files">Extracting Counts from Individual Volume Files</h2>
<p>Now, what if you want to look at terms that don’t occur in the top 10,000. Then, you need to dig in to the files for individual volumes. For simplicity’s sake, I’ll look only at one set of those files, representing volumes of fiction between 1915 and 1919, which I’ve uncompressed in a subdirectory called <code>fiction_1915-1919</code>.</p>
<p>I’ve been using <code>R</code> for everything so far, and I imagine you could use <code>R</code> to loop over the files in the directory, open them up and look for a specified term. As someone who finds <code>R</code> idiosyncratic to the point of excruciation, this doesn’t sound particularly fun. <code>R</code> is great when you’re manipulating/plotting data frames—less so when doing more complicated tasks on the filesystem. So, to extract the information we want, I’ll used a simple bash script.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Our input directory</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="va">INPUTDIRECTORY=</span>./fiction_1915-1919</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s take a single command line argument ($1) and store it</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># as the value we&#39;re looking for (the proverbial needle in our</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co"># data haystack).</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="va">NEEDLE=$1</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co"># We use this convention, with find and while read </span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co"># because a simple for loop, or ls, might have a problem</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co"># with ~10000 files.</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="fu">find</span> <span class="va">$INPUTDIRECTORY</span> <span class="kw">|</span> <span class="kw">while</span> <span class="bu">read</span> <span class="va">file</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="kw">do</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For each file, we use grep to search for our term,</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># storing just the number of occurences in result.</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    <span class="va">result=$(</span><span class="fu">grep</span> -w -m 1 <span class="va">$NEEDLE</span> <span class="va">$file</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{ print $2 }&#39;</span><span class="va">)</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the htid of the file we&#39;re looking at from the filename</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    <span class="va">id=$(</span><span class="fu">basename</span> <span class="va">$file</span> .tsv<span class="va">)</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># And then print the result to the screen</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="va">$id</span>,<span class="va">$result</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="kw">done</span></span></code></pre></div>
<p><span class="marginnote">I’m assuming some familiarity with bash scripts; to make a script executable, using its enough to type <code>chmod +x wordcounter.bash</code>.</span> Save this script to a file (say, <code>wordcounter.bash</code>), make it executable, and then run it with an argument: <code>./wordcounter.bash positivism</code> and it will output to the screen; pipe that to a csv (type <code>./wordcounter.bash positivism &gt; positivism.csv</code>) and you can use it in <code>R</code>. Here is what the results look like when they start appearing on the screen:</p>
<pre><code>bc.ark+=13960=t19k4r10s, 
bc.ark+=13960=t25b0m976, 
bc.ark+=13960=t6tx3tq53, 
chi.086426399, 
chi.086523141, 
chi.64465423, 
chi.73664930, 
coo.31924002898983, 
coo.31924013129774, </code></pre>
<p>Those gibberish-looking strings (<code>bc.ark+=13950=tk19k4r10s</code>) are HathiTrust IDs. Then you get a comma, and after the comma the number of times the term appeared in the file… unless it <em>didn’t</em> appear, in which case you just a blank.</p>
<h2 id="some-notes">Some Notes</h2>
<p>This will only work on unixy systems—Linux, OSX, or (I assume) cygwin on Windows.</p>
<p>When a token does not appear in file, this script outputs the <code>htid</code>, a comma, and then nothing. That’s fine—it’s easier to handle this after we’ve imported the resulting csv (to, say, <code>R</code>) than it would have been to write some logic in this script here to output 0. Also, this crude method is probably faster than doing it within <code>R</code> or Python and is certainly not slower. It could be speeded up by doing something fancy, like parallelization. To search through the 8656 files of <code>fiction_1915-1919</code> for one term took 1 minute and 12 seconds—a totally managable timeframe. Assuming that rate (processing, say, 120 files/second) is roughly constant across the dataset of roughly 180,000 volumes, it should be possible to use this method to search for a term across all the volumes in the dataset in roughly 25 minutes, give or take. That is, of course, based on doing this on my laptop (with a 1.8Ghz Core i5 CPU), no parallelization (though this should be an eminently parallizable task—like really). Not fast, but totally managable.</p>
<h2 id="plotting-our-extracted-counts-from-individual-volume-files">Plotting Our Extracted Counts from Individual Volume Files</h2>
<p>So, assuming the script works… back to <code>R</code>.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Input the data culled by our custom bash script</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>gramophone <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&#39;gramophone.csv&#39;</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>film <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&#39;film.csv&#39;</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>typewriter <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&#39;typewriter.csv&#39;</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Remember all those spots where a token doesn&#39;t occur, </span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># which appear as blanks? Those get read by R as NA </span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co"># values. Here we replace them with zeros.</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>gramophone[<span class="fu">is.na</span>(gramophone)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>film[<span class="fu">is.na</span>(film)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>typewriter[<span class="fu">is.na</span>(typewriter)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s rename our columns</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(gramophone) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;htid&#39;</span>,<span class="st">&#39;gramophone&#39;</span>)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(film) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;htid&#39;</span>,<span class="st">&#39;film&#39;</span>)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(typewriter) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;htid&#39;</span>,<span class="st">&#39;typewriter&#39;</span>)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="co"># We&#39;ll put this data together into one data frame</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="co"># for convenience sake.</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>gft <span class="ot">&lt;-</span> <span class="fu">merge</span>(gramophone,film,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&#39;htid&#39;</span>))</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>gft <span class="ot">&lt;-</span> <span class="fu">merge</span>(gft,typewriter,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&#39;htid&#39;</span>))</span></code></pre></div>
<p>Right now, though, all we have is HathiTrust IDs and frequencies of our term (or terms). We have no information about date, or title. So let’s get that information from the metadata files we’ve worked with earlier.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># From our custom culled data</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>gramophone <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&#39;gramophone.csv&#39;</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>film <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&#39;film.csv&#39;</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>typewriter <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&#39;typewriter.csv&#39;</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co"># All those spots where a token doesn&#39;t occur, which produce blank lines</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>gramophone[<span class="fu">is.na</span>(gramophone)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>film[<span class="fu">is.na</span>(film)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>typewriter[<span class="fu">is.na</span>(typewriter)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(gramophone) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;htid&#39;</span>,<span class="st">&#39;gramophone&#39;</span>)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(film) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;htid&#39;</span>,<span class="st">&#39;film&#39;</span>)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(typewriter) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;htid&#39;</span>,<span class="st">&#39;typewriter&#39;</span>)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="co"># put it all together with our main metadata data frame</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>gft <span class="ot">&lt;-</span> <span class="fu">merge</span>(gramophone,film,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&#39;htid&#39;</span>))</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>gft <span class="ot">&lt;-</span> <span class="fu">merge</span>(gft,typewriter,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&#39;htid&#39;</span>))</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Now get the metadata from fiction_metadata.csv and</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="co"># merge based on htid.</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>fiction.data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&#39;fiction_metadata.csv&#39;</span>,<span class="at">header=</span>T)</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>gft <span class="ot">&lt;-</span> <span class="fu">merge</span>(gft,fiction.data,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&#39;htid&#39;</span>))</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="co"># To normalize let&#39;s load our annual totals as well. We can</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="co"># merge those with our dataframe based on date.</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Get Yearly Totals</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>yearly.summary <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&#39;fiction_yearly_summary.csv&#39;</span>)</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>yearly.total <span class="ot">&lt;-</span> <span class="fu">subset</span>(yearly.summary,yearly.summary<span class="sc">$</span>word<span class="sc">==</span><span class="st">&#39;#DICTIONARYWORD&#39;</span>)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>yearly.total <span class="ot">&lt;-</span> yearly.total[<span class="fu">c</span>(<span class="st">&#39;year&#39;</span>,<span class="st">&#39;termfreq&#39;</span>)]</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(yearly.total) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;date&#39;</span>,<span class="st">&#39;total&#39;</span>)</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge yearly totals with our main dataframe based on date.</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>gft <span class="ot">&lt;-</span> <span class="fu">merge</span>(gft,yearly.total,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&#39;date&#39;</span>))</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Our dataframe is now 23 columns:</span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(gft)</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> [<span class="dv">1</span>] <span class="st">&quot;date&quot;</span>          <span class="st">&quot;htid&quot;</span>          <span class="st">&quot;gramophone&quot;</span>    <span class="st">&quot;film&quot;</span>         </span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> [<span class="dv">5</span>] <span class="st">&quot;typewriter&quot;</span>    <span class="st">&quot;recordid&quot;</span>      <span class="st">&quot;oclc&quot;</span>          <span class="st">&quot;locnum&quot;</span>       </span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> [<span class="dv">9</span>] <span class="st">&quot;author&quot;</span>        <span class="st">&quot;imprint&quot;</span>       <span class="st">&quot;place&quot;</span>         <span class="st">&quot;enumcron&quot;</span>     </span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span>[<span class="dv">13</span>] <span class="st">&quot;subjects&quot;</span>      <span class="st">&quot;title&quot;</span>         <span class="st">&quot;prob80precise&quot;</span> <span class="st">&quot;genrepages&quot;</span>   </span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span>[<span class="dv">17</span>] <span class="st">&quot;totalpages&quot;</span>    <span class="st">&quot;englishpct&quot;</span>    <span class="st">&quot;datetype&quot;</span>      <span class="st">&quot;startdate&quot;</span>    </span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span>[<span class="dv">21</span>] <span class="st">&quot;enddate&quot;</span>       <span class="st">&quot;imprintdate&quot;</span>   <span class="st">&quot;total&quot;</span>        </span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a><span class="co"># That&#39;s not crazy, but to make things easier to under, </span></span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a><span class="co"># let&#39;s subset just the data we&#39;re interested in right now---say,</span></span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a><span class="co"># the occurence of our terms and their date.</span></span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>gft.simple <span class="ot">&lt;-</span> gft[,<span class="fu">c</span>(<span class="st">&#39;date&#39;</span>,<span class="st">&#39;gramophone&#39;</span>,<span class="st">&#39;film&#39;</span>,<span class="st">&#39;typewriter&#39;</span>,<span class="st">&#39;total&#39;</span>)]</span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gft.simple)</span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span>   date gramophone film typewriter     total</span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="dv">1</span> <span class="dv">1915</span>          <span class="dv">0</span>    <span class="dv">0</span>          <span class="dv">0</span> <span class="dv">106553905</span></span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="dv">2</span> <span class="dv">1915</span>          <span class="dv">0</span>    <span class="dv">1</span>          <span class="dv">0</span> <span class="dv">106553905</span></span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="dv">3</span> <span class="dv">1915</span>          <span class="dv">0</span>    <span class="dv">0</span>          <span class="dv">0</span> <span class="dv">106553905</span></span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="dv">4</span> <span class="dv">1915</span>          <span class="dv">0</span>    <span class="dv">0</span>          <span class="dv">0</span> <span class="dv">106553905</span></span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="dv">5</span> <span class="dv">1915</span>          <span class="dv">0</span>    <span class="dv">0</span>          <span class="dv">0</span> <span class="dv">106553905</span></span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="dv">6</span> <span class="dv">1915</span>          <span class="dv">0</span>    <span class="dv">0</span>          <span class="dv">0</span> <span class="dv">106553905</span></span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(gft.simple)</span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> [<span class="dv">1</span>] <span class="dv">8655</span></span></code></pre></div>
<p>Okay, looks good—there are our 8655 volumes, each with date of publication, the occurences of our three search terms (<code>gramophone</code>, <code>film</code>, and <code>typewriter</code>), and the total number of DICTIONARYWORDs for that year. Note that each row still represents a single volume—but we’ve discarded <code>author</code>, <code>title</code>, <code>htid</code>, etc. We’ve also added the total dictionary words for a volume’s year to each row (note the repeated totals in those first 1915 volumes), which is grossly inefficient. All this, however, is in the interest of simplicity—so that we can easily plot the relative occurences of our selected terms (here, <code>gramophone</code>, <code>film</code>, and <code>typewriter</code>).</p>
<p>In order to make this data easily plottable, we need some additional <code>R</code> tricks: we need to reformat our data from a “data frame” to a long “data matrix” (using the <code>melt</code> function). Then we can create a stacked bar graph of terms per year. Let’s start by plotting our raw counts.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our libraries</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2) <span class="co"># For melting data.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)  <span class="co"># For graphing data.</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># This next is necessary b/c R throws an error otherwise. </span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Not totally sure why...</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>gft.simple<span class="sc">$</span>date <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(gft.simple<span class="sc">$</span>date)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a &quot;long&quot; format matrix, from our raw counts data.</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>gft.m <span class="ot">&lt;-</span> <span class="fu">melt</span>(gft.simple[,<span class="fu">c</span>(<span class="st">&#39;date&#39;</span>,<span class="st">&#39;gramophone&#39;</span>,<span class="st">&#39;film&#39;</span>,<span class="st">&#39;typewriter&#39;</span>)],<span class="at">id.vars=</span><span class="st">&#39;date&#39;</span>)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a bar plot of all our values, coded by variable</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gft.m,</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="fu">aes</span>(<span class="fu">factor</span>(date),<span class="at">y=</span>value,<span class="at">fill=</span>variable)) <span class="sc">+</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&#39;identity&#39;</span>) <span class="sc">+</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&#39;Year&#39;</span>) <span class="sc">+</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&#39;Raw Word Occurence&#39;</span>) <span class="sc">+</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Raw Counts for &#39;gramophone,&#39; &#39;film,&#39; and &#39;typewriter&#39;&quot;</span>)</span></code></pre></div>
<p><a href="/images/htdata-plot7.png"><img src="/images/htdata-plot7.png" alt="Stacked Bar Chart of ‘gramophone’,‘film’,‘typewriter’ occurences, in Dataset, 1915-1919" /></a></p>
<p>These are, though, raw counts. To normalize, we can divide the counts for our terms by the total and plot the result.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We&#39;ll create a new data frame for our normalized data, </span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># beginning with out simplified data.</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>gft.normalized <span class="ot">&lt;-</span> gft.simple</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># In this new dataframe, normalize our scores by dividing </span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co"># the raw count in each row by the total in each row.</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>gft.normalized<span class="sc">$</span>gramophone <span class="ot">&lt;-</span> gft.normalized<span class="sc">$</span>gramophone<span class="sc">/</span>gft.normalized<span class="sc">$</span>total</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>gft.normalized<span class="sc">$</span>film <span class="ot">&lt;-</span> gft.normalized<span class="sc">$</span>film<span class="sc">/</span>gft.normalized<span class="sc">$</span>total</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>gft.normalized<span class="sc">$</span>typewriter <span class="ot">&lt;-</span> gft.normalized<span class="sc">$</span>typewriter<span class="sc">/</span>gft.normalized<span class="sc">$</span>total</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co"># How does it look?</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gft.normalized)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> date gramophone         film typewriter     total</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="dv">1</span> <span class="dv">1915</span>          <span class="dv">0</span> <span class="fl">0.000000e+00</span>          <span class="dv">0</span> <span class="dv">106553905</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="dv">2</span> <span class="dv">1915</span>          <span class="dv">0</span> <span class="fl">9.384921e-09</span>          <span class="dv">0</span> <span class="dv">106553905</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="dv">3</span> <span class="dv">1915</span>          <span class="dv">0</span> <span class="fl">0.000000e+00</span>          <span class="dv">0</span> <span class="dv">106553905</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="dv">4</span> <span class="dv">1915</span>          <span class="dv">0</span> <span class="fl">0.000000e+00</span>          <span class="dv">0</span> <span class="dv">106553905</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="dv">5</span> <span class="dv">1915</span>          <span class="dv">0</span> <span class="fl">0.000000e+00</span>          <span class="dv">0</span> <span class="dv">106553905</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="dv">6</span> <span class="dv">1915</span>          <span class="dv">0</span> <span class="fl">0.000000e+00</span>          <span class="dv">0</span> <span class="dv">106553905</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Well, that looks about right. Let&#39;s begin our melt/plot </span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="co"># process again by creating a matrix.</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>gft.norm.m <span class="ot">&lt;-</span> <span class="fu">melt</span>(gft.normalized[,<span class="fu">c</span>(<span class="st">&#39;date&#39;</span>,<span class="st">&#39;gramophone&#39;</span>,<span class="st">&#39;film&#39;</span>,<span class="st">&#39;typewriter&#39;</span>)],<span class="at">id.vars=</span><span class="st">&#39;date&#39;</span>)</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gft.norm.m,<span class="fu">aes</span>(<span class="fu">factor</span>(date),<span class="at">y=</span>value,<span class="at">fill=</span>variable)) <span class="sc">+</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&#39;identity&#39;</span>) <span class="sc">+</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&#39;Year&#39;</span>) <span class="sc">+</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&#39;Normalized Word Frequency (by Year)&#39;</span>) <span class="sc">+</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Normalized Scores for &#39;gramophone,&#39; &#39;film,&#39; and &#39;typewriter&#39;&quot;</span>)</span></code></pre></div>
<p><a href="/images/htdata-plot8.png"><img src="/images/htdata-plot8.png" alt="Normalized, Stacked Bar Chart" /></a></p>
<p>Normalization makes some minor adjustments, but pretty similar. Not sure I would want to make any claims as to the importance or meaning of these graphs. They’re over a short historical span, and so far lack any richer contextualization. Like I said, for now, anticlimaxes.</p>

      </div>
      <div id="disqus_thread"></div>
      <script type="text/javascript"
	      src="http://disqus.com/forums/chrisforstersblog/embed.js">
      </script>
      <noscript>
	<a href="http://chrisforstersblog.disqus.com/?url=ref">View the discussion thread.</a>
      </noscript>
      <a href="http://disqus.com" class="dsq-brlink">
	blog comments powered by <span class="logo-disqus">Disqus</span>
      </a>
    </article>
  </body>

</html>